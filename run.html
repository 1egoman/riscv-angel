<html>
<head> 

<!-- load js libraries required for angel core ops -->
<script src="lib/binfile/binfile.js"></script>
<script src="lib/goog/base.js"></script>
<script>

goog.require("goog.math");
goog.require("goog.math.Long");

</script>

<!-- load angel -->
<script src="elfload.js"></script>
<script src="inst.js"></script>
<script src="cpu.js"></script>
<script src="assemble.js"></script>
<script src="mappings.js"></script>
<!-- <script src="run.js"></script> -->


<!-- bootstrap -->
<link href="style/css/bootstrap.css" rel="stylesheet">
<script src="style/jquery/jquery.js"></script>
<script src="style/js/bootstrap.min.js"></script>

<style type="text/css">
    body { 
        padding-top: 20px;
        padding-bottom: 40px;
    }

    .container-narrow {
        margin: 0 auto;
        max-width: 700px;
    }
</style>

<!-- angel functions -->
<script>

function runCode() {
    userIn = document.getElementById("userCode").value;
    tab = document.getElementById("regtable");
    //console.log(userIn);
    //return userIn;

    userIn = assemble(userIn);

    RISCV = new CPU();

    // load program into memory
    RISCV.load_to_mem([[0, 0], userIn]);

    // run
    var instVal = RISCV.load_word_from_mem(RISCV.pc);
    while(instVal != 0){
        // run instruction
        var inst = new instruction(instVal);
        runInstruction(inst, RISCV);

        // force x0 to zero
        RISCV.gen_reg[0] = 0x0;

        // update output
        for (var i = 0; i < RISCV.gen_reg.length; i++){
            tab.rows[i+1].cells[1].innerHTML = (RISCV.gen_reg[i]|0).toString();
        }

        // load next instruction
        instVal = RISCV.load_word_from_mem(RISCV.pc);
    }
}
</script>

</head>

<body>
<div class="container-narrow">
    <div class="masthead" align="center">
        <h3><a href="#" data-toggle="tooltip" data-placement="bottom" title="ANGEL is Naturally Good at Executing Linux">ANGEL</a> - Browser-based RISC-V ISA simulator</h3>
    </div>

    <div class="row-fluid marketing">
        <div class="span6">
            Your code here:
            <textarea id="userCode" class="row-fluid" rows="20">
Sample: addi $x2, $x2, -1
sw $x2, 0($x0)
lw $x12, 0($x0)
lh $x13, 0($x0)
lb $x14, 0($x0)
lhu $x15, 0($x0)
lbu $x16, 0($x0)
sb $x0, 0($x0)
sb $x0, 1($x0)
lw $x17, 0($x0)
sh $x2, 4($x0)
lh $x18, 4($x0)
jal AddOne
j End
AddOne: addi $x3, $x3, 1
jalr.r $x0, $x1, 0
End: addi $x6, $x6, 200</textarea>
            <br>
            <a class="btn btn-large btn-success" onclick="runCode()">Run</a>
        </div>
        <div class="span6">
            Output:
            <table id="regtable" class="table table-striped table-hover table-condensed table-bordered">
                <tr>
                    <td>Register</td>
                    <td>Value (Signed Decimal)</td>
                </tr>
                <tr>
                    <td>x0 (zero)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x1 (ra)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x2 (s0)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x3 (s1)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x4 (s2)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x5 (s3)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x6 (s4)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x7 (s5)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x8 (s6)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x9 (s7)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x10 (s8)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x11 (s9)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x12 (s10)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x13 (s11)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x14 (sp)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x15 (tp)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x16 (v0)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x17 (v1)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x18 (a0)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x19 (a1)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x20 (a2)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x21 (a3)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x22 (a4)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x23 (a5)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x24 (a6)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x25 (a7)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x26 (a8)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x27 (a9)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x28 (a10)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x29 (a11)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x30 (a12)</td>
                    <td></td>
                </tr>
                <tr>
                    <td>x31 (a13)</td>
                    <td></td>
                </tr>
            </table>
        </div>

    </div>

    <div class="footer">
        Based on <a href="http://inst.eecs.berkeley.edu/~cs152/sp12/handouts/riscv-spec.pdf">The RISC-V Instruction Set Manual</a>
        <!-- nothing here for now -->

    </div>

</div>
</body>

<script>
    // misc end-of-page scripts

    // enable bootstrap tooltips
    $('a').tooltip();
</script>

</html>
